<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å‘˜é¢æ¿</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
</head>
<body>
    <div class="wrapper">

        <!-- ä¸»è¦å†…å®¹ -->
        <main class="main-content">
            <header class="topbar">
                <span class="welcome-text">æ¬¢è¿æ‚¨ï¼Œ{{ session['username'] }}</span>
                <span class="notifications">ğŸ””</span>
                <div class="avatar-dropdown">
                    <button class="avatar-btn" onclick="toggleDropdown()">
                        <img src="{{ url_for('static', filename='img/default-avatar.jpg') }}" alt="Avatar" class="avatar-img">
                    </button>
                    <div class="dropdown-menu" id="dropdownMenu">
                        <span class="dropdown-item">{{ session['username'] }}</span>
                        <a href="{{ url_for('logout') }}" class="dropdown-item logout-btn">é€€å‡ºç™»å½•</a>
                    </div>
                </div>
            </header>

            <section class="content">
                <h2 class="section-title">ç®¡ç†å‘˜åˆ—è¡¨</h2>
                <a href="{{ url_for('campus_schedule') }}" class="btn btn-warning mb-3" style="font-weight:bold;">æ ¡åŒºè¯¾ç¨‹è¡¨</a>

                <!-- æ·»åŠ æ•™å¸ˆè¡¨å• -->
                <form action="{{ url_for('add_teacher') }}" method="post" class="search-bar">
                    <div class="input-group">
                        <label>æ•™å¸ˆåå­—ï¼š</label>
                        <input type="text" name="username" required placeholder="è¯·è¾“å…¥">
                    </div>
                    <div class="input-group">
                        <label>å¯†ç ï¼š</label>
                        <input type="password" name="password" required placeholder="è¯·è¾“å…¥">
                    </div>
                    <button type="submit" class="add-btn">æ·»åŠ æ•™å¸ˆ</button>
                </form>

                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }}">{{ message }}</div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <!-- æ•™å¸ˆè¡¨æ ¼ -->
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>æ•™å¸ˆåç§°</th>
                                <th class="actions-header">æ“ä½œç®¡ç†</th>
                                <th>æ•™å¸ˆåç§°</th>
                                <th class="actions-header">æ“ä½œç®¡ç†</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for i in range(0, teachers|length, 2) %}
                            <tr>
                                <td>{{ teachers[i].username }}</td>
                                <td class="action-buttons">
                                    <a href="{{ url_for('schedule_for_admin', username=teachers[i].username) }}" class="view-btn">æŸ¥çœ‹è¯¾è¡¨</a>
                                    <form action="{{ url_for('update_teacher') }}" method="post" class="d-inline">
                                        <input type="hidden" name="username" value="{{ teachers[i].username }}">
                                        <input type="password" name="new_password" placeholder="è¾“å…¥å¯†ç " required>
                                        <button type="submit" class="edit-btn">ä¿®æ”¹å¯†ç </button>
                                    </form>
                                    <form action="{{ url_for('delete_teacher') }}" method="post" class="d-inline" onsubmit="return confirm('ç¡®å®šè¦åˆ é™¤è¯¥æ•™å¸ˆå—ï¼Ÿ')">
                                        <input type="hidden" name="username" value="{{ teachers[i].username }}">
                                        <button type="submit" class="delete-btn">åˆ é™¤</button>
                                    </form>
                                </td>
                                {% if i + 1 < teachers|length %}
                                <td>{{ teachers[i + 1].username }}</td>
                                <td class="action-buttons">
                                    <a href="{{ url_for('schedule_for_admin', username=teachers[i + 1].username) }}" class="view-btn">æŸ¥çœ‹è¯¾è¡¨</a>
                                    <form action="{{ url_for('update_teacher') }}" method="post" class="d-inline">
                                        <input type="hidden" name="username" value="{{ teachers[i + 1].username }}">
                                        <input type="password" name="new_password" placeholder="è¾“å…¥å¯†ç " required>
                                        <button type="submit" class="edit-btn">ä¿®æ”¹å¯†ç </button>
                                    </form>
                                    <form action="{{ url_for('delete_teacher') }}" method="post" class="d-inline" onsubmit="return confirm('ç¡®å®šè¦åˆ é™¤è¯¥æ•™å¸ˆå—ï¼Ÿ')">
                                        <input type="hidden" name="username" value="{{ teachers[i + 1].username }}">
                                        <button type="submit" class="delete-btn">åˆ é™¤</button>
                                    </form>
                                </td>
                                {% else %}
                                <td></td>
                                <td></td>
                                {% endif %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- åˆ†é¡µ -->
                <div class="pagination">
                    <span>å…±{{ teachers|length }}æ¡æ•°æ®</span>
                </div>
            </section>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function toggleDropdown() {
            const dropdownMenu = document.getElementById('dropdownMenu');
            dropdownMenu.classList.toggle('show');
        }

        // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­ä¸‹æ‹‰èœå•
        window.onclick = function(event) {
            if (!event.target.matches('.avatar-btn') && !event.target.matches('.avatar-img')) {
                const dropdowns = document.getElementsByClassName('dropdown-menu');
                for (let dropdown of dropdowns) {
                    if (dropdown.classList.contains('show')) {
                        dropdown.classList.remove('show');
                    }
                }
            }
        }
    </script>
</body>
</html>
